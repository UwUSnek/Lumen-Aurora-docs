
<!--------------------------------------------------------------------->
<!-- Routine specialization                                          -->
<!--------------------------------------------------------------------->
<h1 id="routine-specialization"></h1>
<moveto-doc->
    <p style="margin-bottom: 0;">
        <b>Routine specialization</b> allows routines to <b>act differently</b> based on the numer of arguments <b>in each routine call</b>, their types and user-defined constraints.<br>
        This is achieved by declaring the same routine multiple times. Each declaration must be <b>unique</b> and can differ by:
    </p>
    <ul><ul>
        <li>Number of parameters (and position of the parameters for operators)</li>
        <li>Types of the parameters</li>
        <li>Suitability constraints</li>
    </ul></ul>
    <br>
    <p style="margin-bottom: 0;">
        Declarations that have less than <i>#a</i> parameters or more than <i>#a</i> parameters without a default value (and for operators, those whose position of the parameters don't match with the position of the arguments in the operator call) are discarded.<br>
        <span class="small hidden">[with <i>#a</i> = number of passed arguments]</span><br>
        <br>
        The remaining declarations are organized in categories and the best one is chosen from one of these.<br>
        The categories are checked one at a time, in the order a, b, c. If no declaration is found, the next category is checked.<br>
        If zero or more than one declaration are found withing the same category, a semantic error is generated.
    </p>
    <ol style="list-style: lower-alpha;">
        <li>Declarations that can take all the parameters without performing implicit conversions.</li>
        <li>Declarations that can take all the parameters by performing one or more constness-only implicit conversions.</li>
        <li>Declarations that can take all the parameters by performing one or more implicit conversions of any kind.</li>
    </ol>
</moveto-doc->
<moveto-examples->
    <split-example-container->
        <split-example-container-left->
            <example->
                <label->Example 1</label->
                <div>
                    <w->import</w-> <s->&lt;io&gt;</s->;

                    <t->void</t-> <f->f</f->(<t->int</t-> <t->const*</t-> <p->p</p->){
                        io.<f->print</f->(<s->"a"</s->);
                    }
                    <t->void</t-> <f->f</f->(<t->int*</t-> <p->p</p->){
                        io.<f->print</f->(<s->"b"</s->);
                    }
                    <t->void</t-> <f->f</f->(<t->ulong</t-> <p->p</p->){
                        io.<f->print</f->(<s->"c"</s->);
                    }


                    <t->void</t-> <f->main</f->(){
                        <t->const</t-> <t->int</t-> n1;
                        <t->int</t->       n2;
                        <t->float</t->     n3;

                        <f->f</f->(<w->addr</w-> n1);   <c->// No implicit conversions</c->
                        <f->f</f->(<w->addr</w-> n2);   <c->// 1 constness-only implicit conversion</c->
                        <f->f</f->(<w->addr</w-> n3);   <c->// 1 implicit conversion</c->
                        <f->f</f->(<k->0.5</k->);       <c->// No implicit conversions</c->
                    }
                </div>
            </example->
        </split-example-container-left->
        <split-example-container-right->
            <example->
                <label->Output</label->
                <div>
                    <console-prefix-></console-prefix->
                    abcc<cursor-></cursor->
                </div>
            </example->
        </split-example-container-right->
    </split-example-container->
</moveto-examples->
<moveto-doc->
    <p style="margin-bottom: 0;">
        Declarations with parameter packs and/or templates undergo an additional instantiation phase before the best declaration is chosen, in which these features are replaced with standard types and parameters.
    </p>
    <ol style="list-style: decimal;">
        <li>
            Each declaration that uses a function parameter pack and has <i>#a</i> or less parameters has its parameter pack replaced with the exact number of parameters of the correct type in order to bring the total to exactly <i>#a</i>.<br>
            <span class="small hidden">[with <i>#a</i> = number of passed arguments]</span>.<br>
            This phase is skipped if the template arguments are specified explicitly.
        </li>
        <li>
            Generated declarations whose number of arguments and argument types are identical to the ones in declarations that don't use function parameter packs are discarded.
        </li>
        <li>
            Each declaration that uses a template is instantiated.<br>
            This phase is skipped if the template arguments are specified explicitly.
        </li>
        <li>
            Generated declarations whose number of arguments and argument types are identical to the ones in declarations that don't use templates are discarded
        </li>
        <li>
            Any declaration whose suitability constraint is not satisfied is discarded
        </li>
    </ol>
</moveto-doc->
<moveto-examples->
    <split-example-container->
        <split-example-container-left->
            <example->
                <label->Example 2</label->
                <div>
                    <w->import</w-> <s->&lt;io&gt;</s->;

                    <t->void</t-> <f->f</f->(?<t->t</t->... <p->args</p->...){
                        io.<f->print</f->(<s->"More than one argument provided\n"</s->);
                    }
                    <t->void</t-> <f->f</f->(?<t->t</t-> <p->arg</p->) {
                        io.<f->print</f->(<s->"The first argument is not a double\n"</s->);
                    }
                    <t->void</t-> <f->f</f->(<t->double</t-> <p->arg</p->) {
                        io.<f->print</f->(<s->"The first argument is a double\n"</s->);
                    }


                    <t->void</t-> <f->main</f->(){
                        <f->f</f->(<k->1</k->);
                        <f->f</f->(<k->1.0</k->);
                        <f->f</f->(<k->1.0</k->, <k->2</k->);
                    }
                </div>
            </example->
        </split-example-container-left->
        <split-example-container-right->
            <example->
                <label->Output</label->
                <div>
                    <console-prefix-></console-prefix->
                    The first argument is not a double
                    The first argument is a double
                    More than one argument provided
                    <cursor-></cursor->
                </div>
            </example->
        </split-example-container-right->
    </split-example-container->
</moveto-examples->