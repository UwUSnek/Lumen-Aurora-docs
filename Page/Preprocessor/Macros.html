<!--------------------------------------------------------------------->
<!-- Macros                                                          -->
<!--------------------------------------------------------------------->
<h1 id="macros"></h1>
<moveto-doc->
    <p>
        //TODO
        import <io>


        #define add(first, second) \
            ($first + $second)

        #define add_3(first, second, third) \
            #add(#add($first, $second) $third)

        #define merge(a, b) \
            #a#b


        void main(){
            io.#merge("pr", "int")(#add_3(5, 12, 0.5));
        }

        //output is 17.5


        //TODO \$ is a special token used to escape a $ in macro definitions. it's only recognized within macro definitions. This is also needed inside of string literals.
            //TODO no \ means "this is a parameter"

        //TODO macro parameter names must be valid identifiers.
            //TODO any non-escaped $ followed by a valid identifier is recognized as a macro parameter

        //TODO Normally, only identifiers and literals can be passed as arguments. Not even keywords are allowed.
            //TODO ` can be used to incldue "anything between them"
            //TODO \` can be used to escape ` delimiters inside of ``

        #define doNothing(argument) $argument

        void main(){
            #doNothing(#add(15, 5));    // Bad. can't pass # or ( as parameter
            #doNothing(`#add(15, 5)`);  // Ok. Expands to #add(15, 5), which exands to (15 + 5)

            #doNothing(`for(int i = 0; i < #add(\`1+1\`, 2);++i)io.print("hi")`);
            // Ok. Expands to for(int i = 0; i < #add(`1+1`, 2);++i)io.print("hi")
            // Which expands to for(int i = 0; i < 1+1 + 2;++i)io.print("hi")
            // Which prints "hi" 3 times
        }


        //TODO extension should draw a └─────┘ under macro arguments to make them more easy to read




        //TODO add to documentation:

        //TODO The result of macro expansion is parsed again in order to expand any resulting macro invocation.
        //TODO This allows macros to invoke other macros and even compose invocations from parameters or other invocations

        //TODO Tokenization happens after macro expansion.
        //TODO This means that macros can merge tokens and paste any character
    </p>
</moveto-doc->
