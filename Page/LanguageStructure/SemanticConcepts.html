
<!--------------------------------------------------------------------->
<!-- Semantic concepts                                               -->
<!--------------------------------------------------------------------->
<h1 id="semantic-concepts"></h1>
<moveto-doc-></moveto-doc->
















<!--------------------------------------------------------------------->
<!-- Scopes                                                          -->
<!--------------------------------------------------------------------->
<h1 id="scopes"></h1>
<moveto-doc->
    <p>
        <b>Scopes</b> define the <a href="#name-resolution"><b>path</b></a> to the <b>symbols</b> declared within them.<br>
        Any portion of code enclosed in <elm-><code>{</code><code>}</code></elm-> tokens defines a new scope.
        The only exception is the module scope, which contains anything declared in the module.
    </p>
    <p>
        Each scope can only contain certain types of <a href="#name-resolution">symbols</a>:
    </p>

    <div class="scope-table-container">
        <div class="table-container scope-table-left-container"><table class="scope-table-left">
            <tr><th class="medium"><div><span>Scope / Can contain</span></div></th></tr>
            <tr><th class="medium"><div><a href="#modules">       Module                                     </a></div></th></tr>
            <tr><th class="medium"><div><a href="#namespaces">    Namespace                                  </a></div></th></tr>
            <tr><th class="medium"><div><a href="#enums">         Enum<span class="hidden">&nbsp;*</span>    </a></div></th></tr>
            <tr><th class="medium"><div><a href="#structs">       Struct<span class="hidden">&nbsp;*</span>  </a></div></th></tr>
            <tr><th class="medium"><div><a href="#functions">     Function<span class="hidden">&nbsp;*</span></a></div></th></tr>
            <tr><th class="medium"><div><a href="#opertors">      Operator<span class="hidden">&nbsp;*</span></a></div></th></tr>
            <tr><th class="medium"><div><a href="#unnamed-scopes">Unnamed<br>scope    </a></div></th></tr>
        </table></div>
        <div class="table-container scope-table-right-container"><table class="scope-table-right">
            <tr>
                <th><div><a class="medium" href="#namespaces">    Namespace                                  </a></div></th>
                <th><div><a class="medium" href="#enums">         Enum<span class="hidden">&nbsp;*</span>    </a></div></th>
                <th><div><a class="medium" href="#structs">       Struct<span class="hidden">&nbsp;*</span>  </a></div></th>
                <th><div><a class="medium" href="#functions">     Function<span class="hidden">&nbsp;*</span></a></div></th>
                <th><div><a class="medium" href="#operators">     Operator<span class="hidden">&nbsp;*</span></a></div></th>
                <th><div><a class="medium" href="#variables">     Variable                                   </a></div></th>
                <th><div><a class="medium" href="#symbol-aliases">Symbol<br>alias                            </a></div></th>
                <th><div><a class="medium" href="#enums">         Enum<br>member                             </a></div></th>
                <th><div><a class="medium" href="#structs">       Struct<br>member                           </a></div></th>
                <th><div><a class="medium" href="#routines">      Routine<br>parameter                       </a></div></th>
            </tr>
            <tr>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
            </tr>
            <tr>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div class="nobefore"><span>Inherited</span></div></td>
                <td class="scope-table-y"><div class="nobefore"><span>Inherited</span></div></td>
                <td class="scope-table-y"><div class="nobefore"><span>Inherited</span></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
            </tr>
            <tr>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
            </tr>
            <tr>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-n"><div></div></td>
            </tr>
            <tr>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-y"><div class="nobefore noafter"><div>Yes<span class="hidden" style="min-width: fit-content; max-width: fit-content;">&nbsp;**</span></div></div></td>
            </tr>
            <tr>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-y"><div class="nobefore noafter"><div>Yes<span class="hidden" style="min-width: fit-content; max-width: fit-content;">&nbsp;**</span></div></div></td>
            </tr>
            <tr>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-y"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
                <td class="scope-table-n"><div></div></td>
            </tr>
        </table></div>
    </div>
    <div>
        <syntax-note->
            * Also applies to the respective <a href="templates">template</a>.<br>
            ** Declared in the routine signature, but part of the routine scope.
        </syntax-note->
    </div>
</moveto-doc->
















<!--------------------------------------------------------------------->
<!-- Name resolution                                                 -->
<!--------------------------------------------------------------------->
<h1 id="name-resolution"></h1>
<moveto-doc->
    <p>
        <b><a href="#semantic-elements.declarations">User defined elements</a></b>, or <a href="#name-resolution">Symbols</a>, can be referenced to use them as <a href="#types">types</a>, access their value or perform <a href="#routine-calls">routine calls</a>.
        This is done through their <b>name</b> or <b>path</b>.
    </p>
    <p>
        The name is the <a href="#identifiers">identifier</a> that was used to declare the <a href="#name-resolution">symbol</a>, optionally followed, if the symbol is a <a href="#templates">template</a>,
        by <elm-><code>&lt;</code><code>&gt;</code></elm-> tokens containing the <a href="#types">types</a> that identify the generated <a href="#name-resolution">symbol</a>.<br>
        Names are used to reference <a href="#name-resolution">symbols</a> that are declared in the current <a href="#scopes">scope</a> or in one of the enclosing ones.
    </p>
    <p>
        Paths, instead, are used to reference <a href="#name-resolution">symbols</a> declared in <a href="#scopes">scopes</a> that are not parents of the current <a href="#scopes">scope</a>.<br>
        They consist of the names of the enclosing <a href="#scopes">scopes</a> of the <a href="#name-resolution">symbol</a> and the name of the <a href="#name-resolution">symbol</a> itself separated by <code>.</code> tokens, starting from the outermost.<br>
        The <code>.</code> token is used to access the children <a href="#name-resolution">symbols</a> of the <a href="#scopes">scope</a>.<br>
        Paths work in the same way as file paths, with <a href="#scopes">scopes</a> acting like directories.
    </p>
    <p>
        The path of a symbol can start from any of its enclosing <a href="#scopes">scopes</a>.<br>
        <a href="#name-resolution">Symbols</a> declared within unnamed <a href="#scopes">scopes</a> cannot be referenced from the outside.<br>
        The <code>module</code> identifier is used to reference the <a href="#scopes">scope</a> of the current <a href="#modules">module</a>.<br>
        A path that starts from the module <a href="#scopes">scope</a> of the current <a href="#modules">module</a> or any of the <a href="#import-directive">imported</a> ones is called an absolute path.
    </p>
</moveto-doc->
<moveto-examples->
    <example->
        <label->Example</label->
        <div>
            <c->// Absolute path: module</c->


            <c->// Absolute path: module.s</c->
            <w->namespace</w-> s {
                <c->// Absolute path: module.s.fun</c->
                <t->void</t-> <f->fun</f->(<t->uint</t-> <p->n</p->) {
                    <c->//        ^</c->
                    <c->// Absolute path: module.s.fun.n</c->
                }
            }

            <w->namespace</w-> {
                <c->// No absolute path, cannot be referenced from outside</c->
                <t->uint</t-> n;
            }
        </div>
    </example->
    <example->
        <label->Example</label->
        <div>
            <c->// Absolute path: module</c->


            <c->// Absolute path: module.s</c->
            <w->namespace</w-> s {
                <c->// Absolute path: module.s.fun</c->
                <t->void</t-> <f->fun</f->(<t->uint</t-> <p->n</p->) {
                    <c->//        ^</c->
                    <c->// Absolute path: module.s.fun.n</c->
                }
            }

            <w->namespace</w-> {
                <c->// No absolute path, cannot be referenced from outside</c->
                <t->uint</t-> n;
            }
        </div>
    </example->
</moveto-examples->















<!--------------------------------------------------------------------->
<!-- Name shadowing                                                  -->
<!--------------------------------------------------------------------->
<h1 id="name-shadowing"></h1>
    <moveto-doc->
    <p>
        <a href="#name-resolution"><b>Symbols</b></a> in <b>different <a href="#scopes">scopes</a></b> can be declared using the <b>same <a href="#identifiers">identifier</a></b>. This is known as <b>name shadowing</b>.<br>
    </p>
    <p>
        When the <a href="#identifiers">identifier</a> is used, the <a href="#name-resolution">symbol</a> declared in the innermost <a href="#scopes">scope</a>, relatively to where the <a href="#identifiers">identifier</a> is used, always takes precedence.
        This can be avoided by starting the <a href="#name-resolution">path</a> from a parent <a href="#scopes">scope</a> so that the <a href="#identifiers">identifier</a> is not ambiguous.<br>
        Any <a href="#identifiers">identifier</a> can be shadowed, including <a href="#primitive-types">primitive types</a>, the <a href="#name-resolution"><code>module</code></a> <a href="#identifiers">identifier</a> and <a href="#name-resolution">symbols</a> from the <a href="#core-module">core module</a>.
    </p>
    <p>
        The first declaration in a scope is the only one that actually shadows eventual identifiers in parent scopes. Subsequent declarations that use the same identifier will refer to the symbol declared in the same scope.<br>
    </p>
</moveto-doc->
<moveto-examples->
    <example->
        <label->Example</label->
        <div>
            <w->namespace</w-> s {
                <w->namespace</w-> {
                    <t->float</t-> n;
                    <c->// n references module.s.*unnamed*.n</c->
                }

                <t->void</t-> <f->n</f->(<t->uint</t-> <p->n</p->) {
                    <c->// n references module.s.n.n</c->
                }

                <c->// n references module.s.n</c->
            }
        </div>
    </example->

    <example->
        <label->Example</label->
        <div>
            <c->// Ok, declares a struct with name "t"</c->
            <w->strct</w-> t {
                <t->int</t-> n;
            }

            <t->void</t-> <f->main</f->(){
                <t->t</t-> t;            <c->// Ok, declares a variable with name "t" and type "module.t"</c->
                <c->//t a;</c->          <ce->// Error, "t" is a variable and not a type</ce->
                <c->//module.t t;</c->   <ce->// Error, redeclaration of "module.main.t"</ce->
                module.<t->t</t-> a;     <c->// Ok, declares a variable with name "a" and type "module.t"</c->
            }

        </div>
    </example->
</moveto-examples->






<!--------------------------------------------------------------------->
<!-- Multiple declarations                                           -->
<!--------------------------------------------------------------------->
<h1 id="multiple-declarations"></h1>
<moveto-doc->
    <p> //TODO linkkk
        Some types of symbol can be declared multiple times in the same scope.<br>
    </p>
    <p>
        <code><w->namespace</w-></code>.<br>
        All the declared namespaces with the same absolute path merge their contents.<br>
        <br>
        Routines.<br>
        Functions and routines declared in the same scope using the same identifier create a specialized routine.<br>
        This is explained in <a href="#routine-specialization">Routine specialization</a>.<br>
        The <code><f->main</f-></code> function cannot be specialized.<br>
        Structs.<br>
        Structs declared in the same scope using the same identifier create a specialized struct.<br>
        This is explained in <a href="#struct-specialization">Struct specialization</a>.<br>
        <br>
        Other symbols.<br>
        Multiple declarations of other symbols generate a semantic error. //TODO LINK
    </p>
</moveto-doc->
<moveto-examples->
    <example->
        <label->Example</label->
        <div>
            <w->namespace</w-> a {     <c->// Ok, merges with the second declaration</c->
                <t->int</t-> n;        <c->// Ok</c->
                <t->int</t-> a;        <c->// Ok, shadows "module.a"</c->
            }
            <w->namespace</w-> a {     <c->// Ok, merges with the first declaration</c->
                <c->//int n;</c->      <ce->// Error, redeclaration of "module.a.n"</ce->
                <t->int</t-> b;        <c->// Ok</c->
            }
            <t->void</t-> <f->main</f->(){
                a.b <f->=</f-> <k->5</k->;      <c->// Ok</c->
            }

            <t->void</t-> <f->f</f->(<t->int</t-> <p->n</p->) { } <c->// Ok</c->
            <t->void</t-> <f->f</f->() { }      <c->// Ok, specialization of "module.f"</c->
        </div>
    </example->
</moveto-examples->








<!--------------------------------------------------------------------->
<!-- Left and right values                                           -->
<!--------------------------------------------------------------------->
<h1 id="left-and-right-values"></h1>
<moveto-doc->
    <p>
        Values can be left values or right values.<br>
        <b>Memory locations</b> which allow <b>changes</b> to their contents after being declared are considered <b>left values</b>.<br>
        Any other value is a <b>right value</b>.
    </p>
    <div class="table-container"><table>
        <tr>
            <th>Left values</th>
            <th>Right values</th>
        </tr>
        <tr>
            <td>Non-const <a href="#functions">parameters</a></td>
            <td><a href="#const-qualifier">Const</a> parameters</td>
        </tr>
        <tr>
            <td>Result of <a href="#element-indexing">element indexing operations</a> (<code>[</code><code>]</code> and <code>.</code>)</td>
            <td>Result of <a href="#function-calls">function calls</a> and <a href="#operator-calls">operator calls</a></td>
        </tr>
        <tr>
            <td>Non-const <a href="#variables">varibales</a></td>
            <td><a href="#const-qualifier">Const</a> variables</td>
        </tr>
        <tr>
            <td><a href="#temporary-variables">Temporary variables</a></td>
            <td><a href="#enums">Enum</a> elements</td>
        </tr>
        <tr>
            <td></td>
            <td><a href="#literals">Literals</a></td>
        </tr>
    </table></div>
    <p>
        Left values can be used anywhere right values can.<br>
        Left and right values are also called l-values and r-values.
    </p>
</moveto-doc->











<!--------------------------------------------------------------------->
<!-- Undefined values                                                -->
<!--------------------------------------------------------------------->
<h1 id="undefined-values"></h1>
<moveto-doc->
    <p>
        <b>Any unknown value</b> of any <a href="#types">type</a> is an <b>undefined value</b>.<br>
        The language can generate undefined values for a variety of reasons.<br>
        Such values are usually the result of errors that occurred during the execution of a <a href="#functions">function</a> and don't contain any useful information.<br>
        Uninitialized <a href="#variables">variables</a> also have undefined value.
    </p>
    <p>
        Generating undefined values during runtime doesn't stop the execution and is not signaled in any way, nor is it detectable.<br>
        The <a href="#modules">module</a> is responsible for preventing, discarding or documenting undefined values.
    </p>
</moveto-doc->
















<!--------------------------------------------------------------------->
<!-- Undefined behaviour                                             -->
<!--------------------------------------------------------------------->
<h1 id="undefined-behaviour"></h1>
<moveto-doc->
    <p>
        Certain actions cause undefined behaviour.<br>
        <b>Undefined behaviour</b> means that the <b>code <a href="#compilation">compiles</a> with no errors</b>, but the <b>runtime behaviour is unknown</b> and anything could happen.<br>
        The software could break, have bugs or work just fine. One cannot know.
    </p>
    <p>
        As with <a href="#undefined-values">undefined values</a>, the <a href="#modules">module</a> is responsible for preventing or documenting undefined behaviours.
    </p>
</moveto-doc->
















<!--------------------------------------------------------------------->
<!-- Compile time expression                                         -->
<!--------------------------------------------------------------------->
<h1 id="compile-time-expressions"></h1>
<moveto-doc->
    <p>
        <b>Compile time expressions</b> are <a href="#expressions">expressions</a> that can be <b>calculated during</b> the <a href="#compilation"><b>compilation</b></a> phase.<br>
        These <a href="#expressions">expressions</a> are required in certain syntaxes, such as <a href="#operators">operator</a> declarations, <a href="#enums">enum</a> elements, <a href="#template">template</a> <a href="#name-resolution">paths</a> and <a href="#specialization-constraints">specialization constraints</a>.<br>
    </p>
    <ul>
        <li>Whether an <a href="#expressions">expression</a> can be compile time or not is determined in the following way:</li>
        <ul>
            <li>
                A <a href="#routine">routine</a> is suitable for compile time <a href="#routine-calls">calls</a> if it is not declared with the <a href="#runtime-qualifier"><code><w->runtime</w-></code> qualifier</a>,
                it doesn't contain <a href="#inline-cpp">inline C++</a> or <a href="#inline-glsl">inline GLSL</a> statements and
                every <a href="#routine-calls">routine call</a> within its body, including constructors and destructor called implicitly or not, are compile time.
            </li>
            <li>
                A <a href="#routine-calls">routine call</a> is compile time if the <a href="#routines">routine</a> is suitable for compile time <a href="#routine-calls">calls</a> and
                all of its <a href="#routine-parameters">arguments</a> are compile time expressions.
            </li>
            <li>
                A <a href="#variables">variable</a> or <a href="#temporary-variables">temporary variable</a> is compile time if its initializer expression is compile time,
                all the <a href="#routine-calls">routine calls</a> in which it is used as <a href="#routine-calls">argument</a> to a <a href="#references">reference</a> <a href="#routine-parameters">parameter</a> refer to routines that are suitable for compile time calls and
                all the additional <a href="#routine-parameters">arguments</a> of such <a href="#routine-calls">calls</a> are compile time expressions.
            </li>
            <li>
                <a href="#literals">Literals</a>, <a href="#enums">enum</a> elements, <a href="#templates">template</a> parameters and <a href="#try-expression"><code><w->try</w-></code> expressions</a> are always compile time.
            </li>
        </ul>
    </ul>
    <p>
        For consistency reasons, cases in which a <a href="#routine">routine</a> is runtime but it doesn't actually need to run during runtime,
        either by containing empty <a href="#inline-cpp">inline C++</a> or <a href="#inline-glsl">inline GLSL</a> statements or
        by containing runtime <a href="#routine-calls">routine calls</a> that are empty or have the aforementioned properties,
        are not considered suitable for compile time <a href="#routine-calls">calls</a>, even though it would be possible to determine their <a href="#return-statement">return value</a> and operations on reference <a href="#routine-parameters">parameters</a> during the <a href="#compilation">compilation</a> process.
    </p>
    <br><br><br>
    <p>
        Notice that compile time expressions are not required to run during compile time, and they don't affect <a href="#value-precomputation">optimizations</a> in any way.<br>
        Compile time expressions are exclusively used to determine which <a href="#expressions">expressions</a> can be used in contexts where a compile time value is required.
    </p>
    <p>
        Any routine declared in <a href="#standard-modules">standard modules</a> that could change the observable behaviour of the program if executed during compile time is properly marked as <a href="#runtime-qualifier"><code><w->runtime</w-></code></a>,
        therefore is not possible to accidentally modify the program behaviour by inadvertently executing <a href="#routines">routines</a> that are not supposed to be executed during the <a href="#compilation">compilation</a> process.
    </p>
    <p>
        //TODO template<t = ulong> t random(t from, t to)
        //TODO template<t = ulong> t random(t to) //from 0
    </p>
</moveto-doc->
<moveto-examples->
    <example->
        <label->Example</label->
        <div>
            <w->from</w-> <s->&lt;random&gt;</s-> <w->include</w-> rand;

            <w->enum</w-> q : <t->bool</t-> {
                to_be     = <k->0</k->,
                not_to_be = <k->1</k->
            }

            <c->// Suitable for compile time calls</c->
            <t->bool</t-> <f->add_1</f->(<t->ulong</t-> <p->n</p->) {
                <w->return</w-> n <f->+</f-> <k->1</k->;
            }


            <t->bool</t-> <f->f</f->(<t->ulong</t-> <p->n</p->) {
                <t->ulong</t-> a = <k->True</k->;

                <c->// return q::elms[n];</c->          <ce->// Error, "n" is not a compile time expression</ce->
                <c->// return q[add_1(n)];</c->   <ce->// Error, the routine call is not compile time</ce->
                <c->// return q[rand(2)];</c->    <ce->// Error, the routine "random.rand" is not suitable for compile time calls</ce->
                <w->return</w-> q<f->[</f->n<f->]</f->;             <c->// Ok</c->
            }
        </div>
    </example->
</moveto-examples->

